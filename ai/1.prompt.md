# AI

当前项目为[aqua-chroma]
是一个自动化的海洋颜色与状况监控系统
已经考虑了下面条件：
核心框架: python uv fastapi
严格使用 uv 作为 python 的包管理工具
就按我的代码风格写
请不要使用传统的diff + / - 格式。请用一种清晰的文本描述格式来展示代码变更，明确指出‘从哪一行开始’到‘哪一行结束’的旧代码块，应该被替换为新的代码块
下面回答全部使用中文回答

```bash
python ./ai/print_project_files.py . "\.(py|yml|toml|md)$|Dockerfile$" -o ./ai/project_context.txt -e ".venv,.git,dist,build,.vscode,ai"
```

### 添加每天的日落日出时间点判断

将当前的每隔10分钟的下载分析的逻辑改为，添加一个前提，是否为可用白天时间段，才能开始下载分析
使用 ephem 判断 经纬度 [122.2, 30] 位置每天的日落日出时间点
相对于日落日出时间点，分别早2小时与晚2小时
比如日出为6:30，则晚2小时为8:30
比如日落为18:30，则早2小时为16:30
所以是 那天的 8:30 - 16:30 之间为去执行下载分析操作，否则跳过


1. 1763015400 少云
2. 1762992600 一半云
3. 1762990200 满云

- 判断少云，可进行海蓝判断
  - 划分出黄与蓝的分界线（打分）
    - 抽取几个区域来判断是否有海蓝百分比（需移除陆地部分，再去划分出黄与蓝的清晰分界线）
      - 大青山 [30.0360, 29.7560, 122.3780, 122.7050]
      - 岱山 [30.4980, 30.2180, 121.8590, 122.1860]
      - 衢山 [30.5730, 30.2930, 122.3110, 122.6380]
      - 嵊泗 [30.9950, 30.7150, 122.3850, 122.7120]
    - 根据这几个区域的海蓝比例，进行打分
- 其余都是 0 分


## 偏灰色，应该是全部云层覆盖，这只是云层的颜色

--- [Processor] K-Means Cluster Analysis ---
  - Cluster 0: RGB=[82 79 78], HSV=[ 8 12 82] -> Identified as: Yellow Water
  - Cluster 1: RGB=[227 229 230], HSV=[100   3 230] -> Identified as: Cloud/White
  - Cluster 2: RGB=[150 152 152], HSV=[ 90   3 152] -> Identified as: Blue Water

## 如果其他两个值S值都大于32，说明不是云层，应该是少云覆盖

--- [Processor] K-Means Cluster Analysis ---
- Cluster 0: RGB=[125 119 116], HSV=[ 10  18 125] -> Identified as: Cloud/White
- Cluster 1: RGB=[42 47 49], HSV=[99 36 49] -> Identified as: Blue Water
- Cluster 2: RGB=[80 63 60], HSV=[ 5 64 80] -> Identified as: Yellow Water

--- [Processor] K-Means Cluster Analysis ---
  - Cluster 0: RGB=[159 155 153], HSV=[ 10  10 159] -> Identified as: Cloud/White
  - Cluster 1: RGB=[90 62 55], HSV=[ 6 99 90] -> Identified as: Yellow Water
  - Cluster 2: RGB=[27 47 49], HSV=[ 93 114  49] -> Identified as: Blue Water

### 有一个值S值小于32，说明有剩余中有一个也是云层

--- [Processor] K-Means Cluster Analysis ---
  - Cluster 0: RGB=[157 156 153], HSV=[ 23 6 157] -> Identified as: Cloud/White
  - Cluster 1: RGB=[104  98  94], HSV=[ 12 25 104] -> Identified as: Undetermined
  - Cluster 2: RGB=[52 40 38], HSV=[ 4 69 52] -> Identified as: Undetermined

## 测试

给 run_analysis_and_persist 中，对原图进行处理到最终生成json结果进行重新封装

因为我要建立测试用例
用例的输入为我筛选的好几张原始图
输出为一步步效果图以及json结果进行对比

所以不需要请求zoomearth的来下载，以免时间过期下载不了。
我会准备好原始图。
你只要给我准备好测试的命令以及每张原始图对应的过程与结果调式图以及结果就行

## run_test_case.py

改进这个测试用例
我希望实时展示，比如一个网页
因为我要实时修改下面的参数值
用来查看每个测试图片的实际效果
COLOR_CLASSIFICATION_HSV_RANGES = {
    # 云/白沫/高亮反光: 通常具有很低的饱和度(S)和很高的明度(V)。
    "CLOUD": {
        "lower": [0, 0, 140],
        "upper": [179, 40, 255]
    },
    # 蓝色的水体: 具有特定的蓝色色相(H)范围。
    "BLUE_WATER": {
        "lower": [85, 0, 0],
        "upper": [130, 255, 255]
    }
    # "黄色的水体" 将作为 "既不是云也不是蓝水" 的其他所有海洋像素的统称。
}